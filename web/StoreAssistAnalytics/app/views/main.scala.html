@(store:String, itemNames:List[String])
<!DOCTYPE html>

<html>
<head>
	<title>Store Analytics</title>
	<link href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet">
	<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
	
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" type="text/javascript"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/highcharts/3.0.2/highcharts.js" type="text/javascript"></script>
	
	<script src="@routes.Assets.at("javascripts/commons.js")" type="text/javascript"></script>
	<script src="@routes.Assets.at("javascripts/moment.min.js")" type="text/javascript"></script>
</head>
<body>
    <div class="container">
		<h1>
		      <img src="@routes.Assets.at("images/freshmadison.png")" width="42" height="42">
			<b><a href="@routes.ReportingController.index()">@store - Analytics</a></b>
		</h1>
    </div>
    <hr>
    
	<div id="content" class="container-fluid">
	  <div class="row-fluid">
        
        <!-- Report Filter Area --> 	  
	    <div class="span2">
        <div class="form form-horizontal">
            <span> 
                 <label for="report_type"><b>Choose a report</b></label> 
                 <select id="report_type" name="report_type">
                    <option value="overall_search" selected="selected">Overall Search Summary</option>
                    <option value="item_search">Item Search Summary</option>
                    <option value="time_search">Time Search Summary</option>
                 </select>
            </span>
            
            <span id="item_name_filter"> 
                 <label for="item_name"><b>Choose a item</b></label> 
                 <select id="item_name" name="item_name">
                    @for(item <- itemNames) {
                        <option value="@item">@item</option>
                    }
                 </select>
            </span>
                        
            <hr> 
            
            <span> 
                 <label><b>Specify a date range</b></label> 
                 <input type="date" name="start_time" id="start_time">
                 <p align="center"><i class="fa fa-long-arrow-down"></i></p>
                 <input type="date" name="end_time" id="end_time">
            </span> 
            
            <p align="center"> <br/><b>OR</b></p>
            
            <span>
                <label><b>Quick dates</b></label>
                <input type="checkbox" id="today_report" name="today_report"> Today : April 16 <br/>
                <input type="checkbox" id="yesterday_report" name="yesterday_report"> Yesterday : April 15 <br/>
                <input type="checkbox" id="last_7_days" name="last_7_days"> Last 7 days <br/>
                <input type="checkbox" id="last_30_days" name="last_30_days"> Last 30 days <br/>
                <input type="checkbox" id="current_month" name="current_month"> This Month : April <br/>
                <input type="checkbox" id="last_month" name="last_month"> Last Month : March <br/>
                <input type="checkbox" id="all_time" name="all_time"> All Time <br/>
            </span>
            <hr>
            
            <span>
                <button id="submit_report" class="btn btn-primary">Submit</button>
            </span>
        </div>
	    </div>
	    
	    <!-- Chart Area -->
	    <div class="span10">
            <div id="report_chart"></div>
            <div id="report_chart2"></div>
	    </div>
	    
	  </div>
	</div>

	<script type="text/javascript">
	$(document).ready(function () {
		
		initialize();
		
		function initialize()
		{
			$("#item_name_filter").hide();
		     loadOverallSummaryChart("2014-04-01", "2014-04-15");
		}
		
		$("#report_type").on("change", function()  {
			var reportType = $("#report_type").val();
			if(reportType == "item_search") {
				$("#item_name_filter").show();
			}
			else {
				$("#item_name_filter").hide();
			}
		});
		
		// Generate relevant report when submit button in clicked
		$("#submit_report").on("click", function() {
			var areFiltersValid = validateFilters();
			if(!areFiltersValid) {
			    alert("Report Filters Invalid !!");	
			}
			
			var dateMap = getDateRangeParameters();
			var startTime = dateMap['start_time'];
			var endTime = dateMap['end_time'];

			var reportType = $("#report_type").val();
			
			console.log(startTime + ',' + endTime + ',' + reportType)
			if(reportType == "overall_search") {
				$("#report_chart2").show();
				
				console.log("Loading overall search report ..");
				loadOverallSummaryChart(startTime, endTime);
			}
			else if (reportType == "item_search") {
				$("#report_chart2").hide();
				
                console.log("Loading item search summary report ..");
                loadItemSearchSummaryReport(startTime, endTime);
			}
			else {
				$("#report_chart2").hide();
				
                console.log("Loading time-based search summary report ..");
                loadTimeBasedSearchSummaryReport(startTime, endTime);
			}
		});
		
		function getDateRangeParameters()
		{
			var dateMap = {};
			var startTime;
			var endTime;
			dateMap['start_time'] = startTime;
			dateMap['end_time'] = endTime;
			
			return dateMap;
		}
		
		function validateFilters()
		{
			return true;
		}
		
		// function to generate the overall summary pie chart
		function loadOverallSummaryChart(startTime, endTime)
		{
			var itemSummary = [];
	        $.ajax({
	             type: 'GET',
	             async: false,
	             url: '/report?reportType=overall_item_search&=startTime=' + startTime + '&endTime=' + endTime,
	             dataType: 'json',
	             success: function(data, textStatus, xhr) {
	                 $.each(data, function (item, frequency) {
	                	 itemSummary.push([item, frequency]);
	                 });
	             }
	         });
	        
            var categorySummary = [];
            $.ajax({
                 type: 'GET',
                 async: false,
                 url: '/report?reportType=overall_category_search&=startTime=' + startTime + '&endTime=' + endTime,
                 dataType: 'json',
                 success: function(data, textStatus, xhr) {
                     $.each(data, function (category, frequency) {
                    	 categorySummary.push([category, frequency]);
                     });
                 }
             });
            
	        var options = getDefaultPieChartOptions();
	        
            var options1 = jQuery.extend(true, {}, options);
            var options2 = jQuery.extend(true, {}, options);
            
	        options1.chart.renderTo = "report_chart";
	        options1.series[0].data = itemSummary;
	        
            options1.title.text = 'Overall Item Search Summary Report';
            options1.subtitle.text = 'Time : (' + startTime + ',' + endTime + ')';
            
            options1.tooltip.formatter = function() {
                return '<b>Item:</b> '+ this.point.name +
                    ', <b>Percentage</b> '+ this.percentage.toFixed(2) +' %';
            }
            
            options2.chart.renderTo = "report_chart2";
            options2.series[0].data = categorySummary;
            
            options2.title.text = 'Overall Category Search Summary Report';
            options2.subtitle.text = 'Time : (' + startTime + ',' + endTime + ')';
            
            options2.tooltip.formatter = function() {
                return '<b>Category:</b> '+ this.point.name +
                    ', <b>Percentage</b> '+ this.percentage.toFixed(2) +' %';
            }
            
            var chart1 = new Highcharts.Chart(options1);
            var chart2 = new Highcharts.Chart(options2);
		}
		
		// function to generate item-based search summary report
		function loadItemSearchSummaryReport(startTime, endTime)
		{
			console.log("Item search summary report ..");
			
			var timeTokens = [];
			var searchFrequencies = [];
            $.ajax({
                type: 'GET',
                async: false,
                url: '/report?reportType=item_search&=startTime=' + startTime + '&endTime=' + endTime,
                dataType: 'json',
                success: function(data, textStatus, xhr) {
                    $.each(data, function (time_token, frequency) {
                    	timeTokens.push(time_token);
                    	searchFrequencies.push(frequency);
                    });
                }
            });
            
            console.log(searchFrequencies);
            console.log(timeTokens);
            
            var options = getDefaultLineChartOptions();
            options.chart.renderTo = "report_chart";
            options.series[0].data = searchFrequencies;
            options.series[0].type = 'line';
            options.series[0].name = 'Item Search History';
            
            options.title.text = 'Item Search Summary Report';
            options.subtitle.text = 'Time : (' + startTime + ',' + endTime + ')';
            
            options.xAxis.title.text = 'Time';
            options.xAxis.categories = timeTokens;
            options.yAxis.title.text = 'Number of searches';

            options.tooltip.formatter = function() {
                return '<b>Time:</b> '+ this.x +
                    ', <b>Searches:</b> '+ this.y;
            }
            
            options.title.text = 'Item Search Summary Report';
            options.subtitle.text = 'Time : (' + startTime + ',' + endTime + ')';
            
			var chart = new Highcharts.Chart(options);
		}
		
		// function to generate time-based item search summary report
		function loadTimeBasedSearchSummaryReport(startTime, endTime)
		{
            console.log("Item search summary report ..");
            
            var timeTokens = [];
            var searchFrequencies = [];
            $.ajax({
                type: 'GET',
                async: false,
                url: '/report?reportType=time_search&=startTime=' + startTime + '&endTime=' + endTime,
                dataType: 'json',
                success: function(data, textStatus, xhr) {
                    $.each(data, function (time_token, frequency) {
                        timeTokens.push(time_token);
                        searchFrequencies.push(frequency);
                    });
                }
            });
            
            console.log(searchFrequencies);
            console.log(timeTokens);
            
            var options = getDefaultLineChartOptions();
            options.chart.renderTo = "report_chart";
            options.series[0].data = searchFrequencies;
            options.series[0].type = 'column';
            options.series[0].name = 'Time-Based Search History';
            
            options.title.text = 'Time-Based Search Summary Report';
            options.subtitle.text = 'Time : (' + startTime + ',' + endTime + ')';
            
            options.xAxis.title.text = 'Time';
            options.xAxis.categories = timeTokens;
            options.yAxis.title.text = 'Number of searches';

            options.tooltip.formatter = function() {
                return '<b>Time:</b> '+ this.x +
                    ', <b>Searches:</b> '+ this.y;
            }
            
            options.title.text = 'Time-Based Search Summary Report';
            options.subtitle.text = 'Time : (' + startTime + ',' + endTime + ')';
            
            var chart = new Highcharts.Chart(options);			
		}
		
	});
	</script>
</body>
</html>
