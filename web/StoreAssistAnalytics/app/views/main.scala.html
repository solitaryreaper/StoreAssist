@(store:String)
<!DOCTYPE html>

<html>
<head>
	<title>Store Analytics</title>
	<link href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet">
	<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
	
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" type="text/javascript"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/highcharts/3.0.2/highcharts.js" type="text/javascript"></script>
	
	<script src="@routes.Assets.at("javascripts/commons.js")" type="text/javascript"></script>
</head>
<body>
    <div class="container">
		<h1>
		      <img src="@routes.Assets.at("images/freshmadison.png")" width="42" height="42">
			<b><a href="@routes.ReportingController.index()">@store - Analytics</a></b>
		</h1>
    </div>
    <hr>
    
	<div id="content" class="container-fluid">
	  <div class="row-fluid">
        
        <!-- Report Filter Area --> 	  
	    <div class="span2">
        <div class="form-horizontal">
            <span> 
                 <label for="report_type"><b>Report</b></label> 
                 <select id="report_type" name="report_type">
                    <option value="overall_search" selected="selected">Overall Search Summary</option>
                    <option value="item_search">Item Search Summary</option>
                    <option value="time_search">Time Search Summary</option>
            </select>
            </span> 
            <span> 
                 <label for="start_time"><b>Start Time</b></label> 
                 <input type="date" name="start_time" id="start_time">
            </span> 
            <span> 
                 <label for="end_time"><b>End Time</b></label> 
                 <input type="date" name="end_time" id="end_time">
            </span>
        
            <br>
            
            <span>
                <button id="submit_report" class="btn btn-primary">Submit</button>
            </span>
        </div>
	    </div>
	    
	    <!-- Chart Area -->
	    <div class="span10">
            <div id="report_chart1"></div>
            <div id="report_chart2"></div>
	    </div>
	    
	  </div>
	</div>

	<script type="text/javascript">
	$(document).ready(function () {
		
		loadOverallSummaryChart("2014-04-01", "2014-04-15");
		
		// Generate relevant report when submit button in clicked
		$("#submit_report").on("click", function() {
			var startTime = $("#start_time").val();
			var endTime = $("#end_time").val();
			var reportType = $("#report_type").val();
			
			console.log(startTime + ',' + endTime + ',' + reportType)
			if(reportType == "overall_search") {
				console.log("Loading overall search report ..");
				loadOverallSummaryChart(startTime, endTime);
			}
			else if (reportType == "item_search") {
                console.log("Loading item search summary report ..");
                loadItemSearchSummaryReport(startTime, endTime);
			}
			else {
                console.log("Loading time-based search summary report ..");
                loadTimeBasedSearchSummaryReport(startTime, endTime);
			}
		});
		
		// function to generate the overall summary pie chart
		function loadOverallSummaryChart(startTime, endTime)
		{
			var itemSummary = [];
	        $.ajax({
	             type: 'GET',
	             async: false,
	             url: 'http://localhost:9000/report?reportType=overall_item_search&=startTime=' + startTime + '&endTime=' + endTime,
	             dataType: 'json',
	             success: function(data, textStatus, xhr) {
	                 $.each(data, function (item, frequency) {
	                	 itemSummary.push([item, frequency]);
	                 });
	             }
	         });
	        
            var categorySummary = [];
            $.ajax({
                 type: 'GET',
                 async: false,
                 url: 'http://localhost:9000/report?reportType=overall_category_search&=startTime=' + startTime + '&endTime=' + endTime,
                 dataType: 'json',
                 success: function(data, textStatus, xhr) {
                     $.each(data, function (category, frequency) {
                    	 categorySummary.push([category, frequency]);
                     });
                 }
             });
            
	        var options = getDefaultPieChartOptions();
	        
            var options1 = jQuery.extend(true, {}, options);
            var options2 = jQuery.extend(true, {}, options);
            
	        options1.chart.renderTo = "report_chart1";
	        options1.series[0].data = itemSummary;
	        
            options1.title.text = 'Overall Item Search Summary Report';
            options1.subtitle.text = 'Time : (' + startTime + ',' + endTime + ')';
            
            options1.tooltip.formatter = function() {
                return '<b>Item:</b> '+ this.point.name +
                    ', <b>Percentage</b> '+ this.percentage.toFixed(2) +' %';
            }
            
            options2.chart.renderTo = "report_chart2";
            options2.series[0].data = categorySummary;
            
            options2.title.text = 'Overall Category Search Summary Report';
            options2.subtitle.text = 'Time : (' + startTime + ',' + endTime + ')';
            
            options2.tooltip.formatter = function() {
                return '<b>Category:</b> '+ this.point.name +
                    ', <b>Percentage</b> '+ this.percentage.toFixed(2) +' %';
            }
            
            var chart1 = new Highcharts.Chart(options1);
            var chart2 = new Highcharts.Chart(options2);
		}
		
		// function to generate item-based search summary report
		function loadItemSearchSummaryReport(startTime, endTime)
		{
			console.log("Item search summary report ..");
			
			var timeTokens = [];
			var searchFrequencies = [];
            $.ajax({
                type: 'GET',
                async: false,
                url: 'http://localhost:9000/report?reportType=item_search&=startTime=' + startTime + '&endTime=' + endTime,
                dataType: 'json',
                success: function(data, textStatus, xhr) {
                    $.each(data, function (time_token, frequency) {
                    	timeTokens.push(time_token);
                    	searchFrequencies.push(frequency);
                    });
                }
            });
            
            console.log(searchFrequencies);
            console.log(timeTokens);
            
            var options = getDefaultLineChartOptions();
            options.chart.renderTo = "report_chart";
            options.series[0].data = searchFrequencies;
            options.series[0].type = 'line';
            options.series[0].name = 'Item Search History';
            
            options.title.text = 'Item Search Summary Report';
            options.subtitle.text = 'Time : (' + startTime + ',' + endTime + ')';
            
            options.xAxis.title.text = 'Time';
            options.xAxis.categories = timeTokens;
            options.yAxis.title.text = 'Number of searches';

            options.tooltip.formatter = function() {
                return '<b>Time:</b> '+ this.x +
                    ', <b>Searches:</b> '+ this.y;
            }
            
            options.title.text = 'Item Search Summary Report';
            options.subtitle.text = 'Time : (' + startTime + ',' + endTime + ')';
            
			var chart = new Highcharts.Chart(options);
		}
		
		// function to generate time-based item search summary report
		function loadTimeBasedSearchSummaryReport(startTime, endTime)
		{
            console.log("Item search summary report ..");
            
            var timeTokens = [];
            var searchFrequencies = [];
            $.ajax({
                type: 'GET',
                async: false,
                url: 'http://localhost:9000/report?reportType=time_search&=startTime=' + startTime + '&endTime=' + endTime,
                dataType: 'json',
                success: function(data, textStatus, xhr) {
                    $.each(data, function (time_token, frequency) {
                        timeTokens.push(time_token);
                        searchFrequencies.push(frequency);
                    });
                }
            });
            
            console.log(searchFrequencies);
            console.log(timeTokens);
            
            var options = getDefaultLineChartOptions();
            options.chart.renderTo = "report_chart";
            options.series[0].data = searchFrequencies;
            options.series[0].type = 'column';
            options.series[0].name = 'Time-Based Search History';
            
            options.title.text = 'Time-Based Search Summary Report';
            options.subtitle.text = 'Time : (' + startTime + ',' + endTime + ')';
            
            options.xAxis.title.text = 'Time';
            options.xAxis.categories = timeTokens;
            options.yAxis.title.text = 'Number of searches';

            options.tooltip.formatter = function() {
                return '<b>Time:</b> '+ this.x +
                    ', <b>Searches:</b> '+ this.y;
            }
            
            options.title.text = 'Time-Based Search Summary Report';
            options.subtitle.text = 'Time : (' + startTime + ',' + endTime + ')';
            
            var chart = new Highcharts.Chart(options);			
		}
		
	});
	</script>
</body>
</html>
